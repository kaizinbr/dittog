<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seu currículo!</title>

     <!-- Bootstrap CSS -->
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
 
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
</head>
<body class="" id="body">

    <main class="px-5">
        <section class="row gy-4 mt-3 justify-content-center grid " >
            <h2>Dados Pessoais</h2>
            <hr>
            <div class="mb-3 mx-3 rounded-3 border col-10  bg-light text-dark">
                <p class="text-muted ">Nome Completo</p>
                <h4>Nome da pessoa</h4>
            </div>
            
            <div class="mb-3 mx-3 rounded-3 border col-5  bg-light text-dark">
                <p class="text-muted ">Idade</p>
                <h4>16</h4>
            </div>
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Telefone</p>
                <h4>83 91234-5678</h4>
            </div>
            
            <div class="mb-3 mx-3 rounded-3 border col-10 p-2 bg-light text-dark">
                <p class="text-muted ">E-mail</p>
                <h4>joaozincraft@gmail.com</h4>
            </div>
            
            <div class="mb-3 mx-3 rounded-3 border col-10 p-2 bg-light text-dark">
                <p class="text-muted ">Endereço</p>
                <h4>Endereço país, estado, cidade</h4>
            </div>
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">LinkedIn</p>
                <h4>username</h4>
            </div>
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Github</p>
                <h4>github.io/username</h4>
            </div>
            

            <h2>Habilidades</h2>
            <hr>

            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Nome da habilidade</p>
                <h4>Nível da habilidade</h4>
            </div>
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Nome da habilidade</p>
                <h4>Nível da habilidade</h4>
            </div>
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Nome da habilidade</p>
                <h4>Nível da habilidade</h4>
            </div>
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Nome da habilidade</p>
                <h4>Nível da habilidade</h4>
            </div>            
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Nome da habilidade</p>
                <h4>Nível da habilidade</h4>
            </div>
            
            <h2>Objetivo Profissional</h2>
            <hr>

            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Área de atuação</p>
                <h4>Área</h4>
            </div>            
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Especialização</p>
                <h4>Área</h4>
            </div>
            <h2>Formação Acadêmica</h2>
            <hr>
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Nível da Graduação</p>
                <h4>Nível</h4>
            </div>            
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Nome da Instituição</p>
                <h4>Instituição</h4>
            </div>
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Período</p>
                <h4>xx/xx/xxxx - xx/xx/xxxx</h4>
            </div>            
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Duração</p>
                <h4>x anos</h4>
            </div>
          
          
        <h2>Experiência Profissional</h2>
        <hr>
        <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
            <p class="text-muted ">Nome da Empresa</p>
            <h4>Nome</h4>
        </div>            
        
        <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
            <p class="text-muted ">Período na Empresa</p>
            <h4>x anos</h4>
        </div>
        <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
            <p class="text-muted ">Cargo</p>
            <h4>cargo</h4>
        </div>            
        
        <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
            <p class="text-muted ">Descrição</p>
            <p>Breve descrição das atividades desenvolvidas na empresa Lorem ipsum dolor sit amet, consectetur adipisicing elit. Omnis assumenda consectetur obcaecati totam iusto magnam officia quaerat, consequuntur id dicta dolor accusamus ea hic repudiandae alias harum rerum aperiam qui.</p>
        </div>
      

        <h2>Cursos Extracurriculares</h2>
        <hr>
        <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
            <p class="text-muted">Nome do Curso</p>
            <h4>Nome</h4>

            <p class="text-muted">Duração do Curso</p>
            <h4>x anos</h4>

            <p class="text-muted">Tipo do Curso</p>
            <h4>tipo</h4>
        </div>
        
        <h2>Atividades Complementares</h2>
        <hr>
        <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
            <p class="text-muted">Nome da Atividade</p>
            <h4>Nome</h4>

            <p class="text-muted">Duração da Atividade</p>
            <h4>x anos</h4>

            <p class="text-muted">Tipo de Atividade</p>
            <h4>tipo</h4>

            <p class="text-muted">Participando Atualmente?</p>
            <h4>Sim</h4>
        </div>
           
            
    </section>
    </main>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script type="module">

    import Auth from './src/auth.js';
    
    document.body.onload = renderInfos;

    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id'); // id do curriculo
    let userId; // id do usuario que criou o curriculo

      async function renderInfos() {

        const config = {
        method: 'get',
        headers: {
          Authorization: `Bearer ${Auth.getToken()}`,
        },
      };
      
        const url = `/curriculum-info/id/${id}`;

        const tempCurriculo = await (await fetch(url, config)).json();

        userId = tempCurriculo.curriculo.usuario_id; //pega o id de usuario para enviar o curriculo por email
        //console.log(userId);

        let curriculo = {
                nome: tempCurriculo.curriculo.nome_completo,
                idade: tempCurriculo.curriculo.idade,
                tel: tempCurriculo.curriculo.telefone,
                email: tempCurriculo.curriculo.email,
                pais: tempCurriculo.curriculo.pais,
                estado: tempCurriculo.curriculo.estado,
                cidade: tempCurriculo.curriculo.cidade,
                linkedin: tempCurriculo.curriculo.linkedin,
                github: tempCurriculo.curriculo.github,
                habilidades: [{
                    nome: tempCurriculo.habilidades[0].nome_habilidade,
                    nivel: tempCurriculo.habilidades[0].nivel_da_habilidade
                }, {
                    nome: tempCurriculo.habilidades[1].nome_habilidade,
                    nivel: tempCurriculo.habilidades[1].nivel_da_habilidade
                }, {
                    nome: tempCurriculo.habilidades[2].nome_habilidade,
                    nivel: tempCurriculo.habilidades[2].nivel_da_habilidade
                }, {
                    nome: tempCurriculo.habilidades[3].nome_habilidade,
                    nivel: tempCurriculo.habilidades[3].nivel_da_habilidade
                }, {
                    nome: tempCurriculo.habilidades[4].nome_habilidade,
                    nivel: tempCurriculo.habilidades[4].nivel_da_habilidade
                }],
                nomeArea: tempCurriculo.curriculo.area_de_atuacao,
                nomeEspecializacao: tempCurriculo.curriculo.especializacao,
                nomeFormacao: tempCurriculo.curriculo.nome_da_formacao,
                nivelFormacao: tempCurriculo.curriculo.nivel_da_formacao,
                nomeInstituicao: tempCurriculo.curriculo.nome_da_instituicao,
                periodoFormacao: tempCurriculo.curriculo.periodo_da_formacao,
                duracaoFormacao: tempCurriculo.curriculo.duracao_da_formacao,
                nomeEmpresa: tempCurriculo.curriculo.nome_da_empresa,
                cargoExp: tempCurriculo.curriculo.cargo_da_experiencia,
                periodoExp: tempCurriculo.curriculo.periodo_da_experiencia,
                descricaoExp: tempCurriculo.curriculo.descricao_da_experiencia,
                nomeCur: tempCurriculo.curriculo.nome_do_curso,
                duracaoCur: tempCurriculo.curriculo.duracao_do_curso,
                tipoCur: tempCurriculo.curriculo.tipo_do_curso,
                atividades_complementares: [{
                    nome: tempCurriculo.atividades[0].nome_atividade,
                    duracao: tempCurriculo.atividades[0].duracao_atividade,
                    tipo: tempCurriculo.atividades[0].tipo_atividade,
                    atualmente: tempCurriculo.atividades[0].faz_atualmente
                }, {
                    nome: tempCurriculo.atividades[1].nome_atividade,
                    duracao: tempCurriculo.atividades[1].duracao_atividade,
                    tipo: tempCurriculo.atividades[1].tipo_atividade,
                    atualmente: tempCurriculo.atividades[1].faz_atualmente
                }, {
                    nome: tempCurriculo.atividades[2].nome_atividade,
                    duracao: tempCurriculo.atividades[2].duracao_atividade,
                    tipo: tempCurriculo.atividades[2].tipo_atividade,
                    atualmente: tempCurriculo.atividades[2].faz_atualmente
                }
                ],


            };

    let habilidadesToPrint = printHabilidades();
    let atividadesToPrint = printAtividades();

    const view = `<body class="">
<button id="print" class="btn btn-primary"><span class="material-icons">print</span></button>
<button id="outgoing_mail" class="btn btn-primary"><span class="material-icons">outgoing_mail</span></button>

    <main class="px-5">
        <section class="row gy-4 mt-3 justify-content-center grid " >
            <h2>Dados Pessoais</h2>
            <hr>
            <div class="mb-3 mx-3 rounded-3 border col-10  bg-light text-dark">
                <p class="text-muted ">Nome Completo</p>
                <h4>${curriculo.nome}</h4>
            </div>
            
            <div class="mb-3 mx-3 rounded-3 border col-5  bg-light text-dark">
                <p class="text-muted ">Idade</p>
                <h4>${curriculo.idade}</h4>
            </div>
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Telefone</p>
                <h4>${curriculo.tel}</h4>
            </div>
            
            <div class="mb-3 mx-3 rounded-3 border col-10 p-2 bg-light text-dark">
                <p class="text-muted ">E-mail</p>
                <h4>${curriculo.email}</h4>
            </div>
            
            <div class="mb-3 mx-3 rounded-3 border col-10 p-2 bg-light text-dark">
                <p class="text-muted ">Endereço</p>
                <h4>${curriculo.pais}, ${curriculo.estado}, ${curriculo.cidade}</h4>
            </div>
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">LinkedIn</p>
                <h4>${curriculo.linkedin}</h4>
            </div>
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Github</p>
                <h4>github.io/${curriculo.github}</h4>
            </div>
            

            <h2>Habilidades</h2>
            <hr class="habilidades">

            ${habilidadesToPrint}                    
            
            <h2>Objetivo Profissional</h2>
            <hr>

            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Área de atuação</p>
                <h4>${curriculo.nomeArea}</h4>
            </div>            
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Especialização</p>
                <h4>${curriculo.nomeEspecializacao}</h4>
            </div>
            <h2>Formação Acadêmica</h2>
            <hr>
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Nível da Graduação</p>
                <h4>${curriculo.nivelFormacao}</h4>
            </div>            
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Nome da Instituição</p>
                <h4>${curriculo.nomeInstituicao}</h4>
            </div>
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Período</p>
                <h4>${curriculo.periodoFormacao}</h4>
            </div>            
            
            <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                <p class="text-muted ">Duração</p>
                <h4>${curriculo.duracaoFormacao}</h4>
            </div>
        
        
        <h2>Experiência Profissional</h2>
        <hr>
        <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
            <p class="text-muted ">Nome da Empresa</p>
            <h4>${curriculo.nomeEmpresa}</h4>
        </div>            
        
        <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
            <p class="text-muted ">Período na Empresa</p>
            <h4>${curriculo.periodoExp}</h4>
        </div>
        <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
            <p class="text-muted ">Cargo</p>
            <h4>${curriculo.cargoExp}</h4>
        </div>            
        
        <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
            <p class="text-muted ">Descrição</p>
            <p>${curriculo.descricaoExp}</p>
        </div>


        <h2>Cursos Extracurriculares</h2>
        <hr>
        <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
            <p class="text-muted">Nome do Curso</p>
            <h4>${curriculo.nomeCur}</h4>
      
            <p class="text-muted">Duração do Curso</p>
            <h4>${curriculo.duracaoCur}</h4>
      
            <p class="text-muted">Tipo do Curso</p>
            <h4>${curriculo.tipoCur}</h4>
        </div>
    
        <h2>Atividades Complementares</h2>
        <hr> 
        ${atividadesToPrint}
        
            
        </section>
        </main>
        </body>`

    // window.print();

    function printHabilidades() {
        let response = '';

        for (let i = 0; i < curriculo.habilidades.length; i++) {
            if (curriculo.habilidades[i].nome !== '' && curriculo.habilidades[i].nome !== undefined && curriculo.habilidades[i].nome !== '.') {
                response += `
                <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                    <p class="text-muted ">${curriculo.habilidades[i].nivel}</p>
                    <h4>${curriculo.habilidades[i].nome}</h4>
                </div>`
            }
        }
      
        return response;
      }

      function printAtividades() {
        let response = '';
      
        for (let i = 0; i < curriculo.atividades_complementares.length; i++) {
            if (curriculo.atividades_complementares[i].nome !== '' && curriculo.atividades_complementares[i].nome !== undefined) {
                response += `
                <div class="mb-3 mx-3 rounded-3 border col-5 p-2 bg-light text-dark">
                    <p class="text-muted">Nome da Atividade</p>
                    <h4>${curriculo.atividades_complementares[i].nome}</h4>
      
                    <p class="text-muted">Duração da Atividade</p>
                    <h4>${curriculo.atividades_complementares[i].duracao}</h4>
      
                    <p class="text-muted">Tipo de Atividade</p>
                    <h4>${curriculo.atividades_complementares[i].tipo}</h4>
      
                    <p class="text-muted">Participando Atualmente?</p>
                    <h4>${curriculo.atividades_complementares[i].atualmente}</h4>
                </div>`
            }
        }
      
        return response;
        }

        const body = document.getElementById('body');

        body.innerHTML = view;
        document.getElementById('print').onclick = toPrintPage;
        document.getElementById('outgoing_mail').onclick = toSendEmail;

}

    function toPrintPage() {
      const print = document.getElementById('print')
      print.remove()

      const outgoing_mail = document.getElementById('outgoing_mail')
      outgoing_mail.remove()
      
      window.print()

      const body = document.querySelector('body')

      const view = `<button id="print" class="btn btn-primary"><span class="material-icons">print</span></button>
<button id="outgoing_mail" class="btn btn-primary"><span class="material-icons">outgoing_mail</span></button>
      `

      body.insertAdjacentHTML('afterbegin', view);
      
      document.getElementById('print').onclick = toPrintPage;
      document.getElementById('outgoing_mail').onclick = toSendEmail;
    }

    async function getMail() {
        const url = `/usuario-info/id/${userId}`;
        const config = {
        method: 'get',
        headers: {
          Authorization: `Bearer ${Auth.getToken()}`,
        },
      };
        const userData = await (await fetch(url, config)).json();
        console.log(userData);

        const email = userData.login;
        console.log(email);

        return email;
    };

    async function toSendEmail() {
      const print = document.getElementById('print')
      print.remove()

      const outgoing_mail = document.getElementById('outgoing_mail')
      outgoing_mail.remove();

      const email = await getMail();
      //console.log(email);

      // Falta coletar email para enviar como to
      const emailContent = {
        to: email,
        htmlContent: document.documentElement.innerHTML
      }

      await fetch("/send-curriculum", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${Auth.getToken()}`,
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(emailContent),
            })
                .then((response) => response.json())
                .then((data) => {
                    // lastID = data.id;
                    console.log("Success:", data);
                })
                .catch((error) => {
                    console.error("Error:", error);
                });

      const view = `<button id="print" class="btn btn-primary"><span class="material-icons">print</span></button>
<button id="outgoing_mail" class="btn btn-primary"><span class="material-icons">outgoing_mail</span></button>
      `

      body.insertAdjacentHTML('afterbegin', view);
      
      document.getElementById('print').onclick = toPrintPage;
      document.getElementById('outgoing_mail').onclick = toSendEmail;
    }

    </script>
</body>
</html>